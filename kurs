import asyncio

from telethon import events

from .. import loader, utils


@loader.tds
class IDModule(loader.Module):
    """Получает ID пользователя Telegram"""

    strings = {"name": "ID"}

    async def client_ready(self, client, db):
        self.client = client

    @loader.unrestricted
    async def idcmd(self, message):
        """Используй: .id @username/реплай на сообщение"""
        args = utils.get_args_raw(message)
        reply = await message.get_reply_message()

        if not args and not reply:
            await utils.answer(message, "<b>Нет аргументов или реплая.</b>")
            return

        user = None
        if args:
            try:
                user = await self.client.get_entity(args)
            except ValueError:
                await utils.answer(message, "<b>Не удалось найти пользователя.</b>")
                return
        elif reply:
            user = reply.sender
        
        if not user:
            return

        await utils.answer(message, f"<b>ID пользователя {user.first_name}: <code>{user.id}</code></b>")
